@if (entity$ | async; as entity) {

  <mat-sidenav-container>
    <mat-sidenav opened mode="side">
      <mat-action-list>
        <button mat-list-item (click)="selectTab('General')" class="test">
            <mat-icon
              matTooltip="{{ 'Section contains required fields' | translate }}"
              [color]="(generalInformationValid$ | async) ? 'primary' : 'accent'"
              class="required-info"
              >
              label_important
            </mat-icon>
            {{ 'General Information' | translate }}
        </button>
        <button mat-list-item (click)="selectTab('Licence')">
          <mat-icon
            matTooltip="{{ 'Section contains required fields' | translate }}"
            [color]="(licenceValid$ | async) ? 'primary' : 'accent'"
            class="required-info"
            >
            label_important
          </mat-icon>
          {{ 'Licence' | translate }}
        </button>
        <!-- <button mat-list-item (click)="selectTab(2)">
          @if (digitalEntity$ | async; as digitalEntity) {
            <mat-icon
              matTooltip="{{ 'Section contains required fields' | translate }}"
                [color]="
                  (personsValid$ | async) && (hasRightsOwner$ | async) && (hasContactPerson$ | async)
                    ? 'primary'
                    : 'accent'
                "
              class="required-info"
              >
              label_important
            </mat-icon>
          } @else {
            <mat-icon
              matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
              [color]="(personsValid$ | async) ? 'primary' : 'accent'"
              class="required-info"
              >
              label
            </mat-icon>
          }
          <span>{{ 'Persons' | translate }}</span>
          @if (entity.persons.length > 0) {
            <span> ({{ entity.persons.length }}) </span>
          }
          <button
            mat-icon-button
            color="primary"
            (click)="addSimpleProperty($event, entity, 'persons')"
            >
            <mat-icon>add_circle</mat-icon>
          </button>
        </button> -->
        <!-- <button mat-list-item (click)="selectTab(3)">
          @if (digitalEntity$ | async; as digitalEntity) {
            <mat-icon
              matTooltip="{{ 'Section contains required fields' | translate }}"
                [color]="
                  (institutionsValid$ | async) && (hasRightsOwner$ | async) ? 'primary' : 'accent'
                "
              class="required-info"
              >
              label_important
            </mat-icon>
          } @else {
            <mat-icon
              matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
              [color]="(institutionsValid$ | async) ? 'primary' : 'accent'"
              class="required-info"
              >
              label
            </mat-icon>
          }
          <span>{{ 'Institutions' | translate }}</span>
          @if (entity.institutions.length > 0) {
            <span> ({{ entity.institutions.length }}) </span>
          }
          <button
            mat-icon-button
            color="primary"
            (click)="addSimpleProperty($event, entity, 'institutions')"
            >
            <mat-icon>add_circle</mat-icon>
          </button>
        </button> -->
        
        <button mat-list-item (click)="selectTab('Related')">
          @if (digitalEntity$ | async; as digitalEntity) {
            <mat-icon
            matTooltip="{{ 'Section contains required fields' | translate }}"
              [color]="
                (personsValid$ | async) && (institutionsValid$ | async) && (hasRightsOwner$ | async) && (hasCreator$ | async)
                  ? 'primary'
                  : 'accent'
              "
            class="required-info"
            >
            label_important
          </mat-icon>
          } @else {
            <mat-icon
              matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
              [color]="(institutionsValid$ | async) ? 'primary' : 'accent'"
              class="required-info"
              >
              label
            </mat-icon>
          }
          <span>{{ 'Related persons and institutions' | translate }}</span>
        </button>

        <p class="optional-text">{{'Optional metadata:' | translate }}</p>
        <!-- <button mat-list-item (click)="selectTab(4)">
          @if (digitalEntity$ | async; as digitalEntity) {
          <mat-icon
            matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
            [color]="(dimensionsValid$ | async) ? 'primary' : 'accent'"
            class="required-info"
            >
            label
          </mat-icon>
          <span>{{ 'Dimensions' | translate }}</span>
          @if (digitalEntity.dimensions.length > 0) {
            <span>
              ({{ digitalEntity.dimensions.length }})
            </span>
          }
          <button
            mat-icon-button
            color="primary"
            (click)="addSimpleProperty($event, digitalEntity, 'dimensions')"
            >
            <mat-icon>add_circle</mat-icon>
          </button>
        }
        </button> -->
        <button mat-list-item (click)="selectTab('Creation')">
          @if (digitalEntity$ | async; as digitalEntity) {
          <mat-icon
          matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
          [color]="(creationValid$ | async) ? 'primary' : 'accent'"
          class="required-info"
          >
          label
          </mat-icon>
          <span>{{ 'Creation' | translate }}</span>
          @if (digitalEntity.creation.length > 0) {
            <span>
              ({{ digitalEntity.creation.length }})
            </span>
          }
          }
        </button>
        <!-- <button mat-list-item (click)="selectTab('')">
          <mat-icon
            matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
            [color]="(externalIdValid$ | async) ? 'primary' : 'accent'"
            class="required-info"
            >
            label
          </mat-icon>
          <span>{{ 'External Identifiers' | translate }}</span>
          @if (entity.externalId.length > 0) {
            <span> ({{ entity.externalId.length }}) </span>
          }
      <button
        mat-icon-button
        color="primary"
        (click)="addSimpleProperty($event, entity, 'externalId')"
        >
        <mat-icon>add_circle</mat-icon>
      </button>
        </button> -->
        <button mat-list-item (click)="selectTab('Links')">
          <mat-icon
            matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
            [color]="(externalLinkValid$ | async) ? 'primary' : 'accent'"
            class="required-info"
            >
            label
          </mat-icon>
          <span>{{ 'External Links' | translate }}</span>
          @if (entity.externalLink.length > 0) {
            <span> ({{ entity.externalLink.length }}) </span>
          }
          <!-- <button
            mat-icon-button
            color="primary"
            (click)="addSimpleProperty($event, entity, 'externalLink')"
            >
            <mat-icon>add_circle</mat-icon>
          </button> -->
        </button>
        <button mat-list-item (click)="selectTab('References')">
          <mat-icon
          matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
          [color]="(biblioRefsValid$ | async) ? 'primary' : 'accent'"
          class="required-info"
          >
          label
          </mat-icon>
          <span>{{ 'Bibliographic References' | translate }}</span>
          @if (entity.biblioRefs.length > 0) {
            <span> ({{ entity.biblioRefs.length }}) </span>
          }
          <!-- <button
            mat-icon-button
            color="primary"
            (click)="addSimpleProperty($event, entity, 'biblioRefs')"
            >
            <mat-icon>add_circle</mat-icon>
          </button> -->
        </button>
        <!-- <button mat-list-item (click)="selectTab('')">
          <mat-icon
          matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
          [color]="(otherValid$ | async) ? 'primary' : 'accent'"
          class="required-info"
          >
          label
          </mat-icon>
          <span>{{ 'Other' | translate }}</span>
          @if (entity.other.length > 0) {
            <span> ({{ entity.other.length }}) </span>
          }
          <button
            mat-icon-button
            color="primary"
            (click)="addSimpleProperty($event, entity, 'other')"
            >
            <mat-icon>add_circle</mat-icon>
          </button>
        </button> -->
        <!-- <button mat-list-item (click)="selectTab('')">
          <mat-icon
            matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
            [color]="(metadataFilesValid$ | async) ? 'primary' : 'accent'"
            class="required-info"
            >
            label
          </mat-icon>
          <span>{{ 'Metadata Files' | translate }}</span>
          @if (entity.metadata_files.length > 0) {
            <span>
              ({{ entity.metadata_files.length }})
            </span>
          }
          <button
            mat-icon-button
            color="primary"
            (click)="addSimpleProperty($event, entity, 'metadata_files')"
            >
            <mat-icon>add_circle</mat-icon>
          </button>
        </button> -->
        <button mat-list-item (click)="selectTab('Physical')">
          @if (digitalEntity$ | async; as digitalEntity) {
            <mat-icon
            matTooltip="{{ 'Section is optional, but any added elements need to be filled' | translate }}"
            [color]="(phyObjsValid$ | async) ? 'primary' : 'accent'"
            >
            label
            </mat-icon>
            <span>{{ 'Physical Objects' | translate }}</span>
            <!-- @if (digitalEntity.phyObjs.length > 0) {
              <span>
                ({{ digitalEntity.phyObjs.length }})
              </span>
            } -->
            <!-- <button
              mat-icon-button
              color="primary"
              (click)="addSimpleProperty($event, digitalEntity, 'phyObjs')"
              >
              <mat-icon>add_circle</mat-icon>
            </button> -->
          }
        </button>
      </mat-action-list>
    </mat-sidenav>
    <mat-sidenav-content>
      <mat-tab-group [(selectedIndex)]="selectedTabIndex" animationDuration="0ms">
        <!-- General Information -->
         <mat-tab>
          @if (digitalEntity$ | async; as digitalEntity) {
          <app-general [entity]="entity" [digitalEntity]="digitalEntity"></app-general>
          }
        </mat-tab>
        <!-- /General Information -->

        <!-- Licence -->
        <mat-tab>
          @if (digitalEntity$ | async; as digitalEntity) {
          <div class="form-fields">
            <mat-radio-group class="licence-selection" [(ngModel)]="digitalEntity.licence">
              @for (licence of availableLicences; track licence) {
                <mat-radio-button [value]="licence.title">
                  <img [src]="licence.src" [alt]="licence.title" />
                  <a
                    [href]="licence.link"
                    target="_blank"
                    referrerpolicy="no-referrer"
                    rel="noreferrer"
                    [title]="licence.link"
                    >{{ licence.description }}</a
                    >
                  </mat-radio-button>
                }
              </mat-radio-group>
          </div>
        }
        </mat-tab>
        <!-- /Licence -->

        <!-- Persons -->
        <!-- <mat-tab>
          @if (_id$ | async; as entityId) {
          <div>
            <mat-form-field>
              <mat-label>{{ 'Search for an existing person' | translate }}</mat-label>
              <input
                type="text"
                placeholder="{{ 'Enter the name of a person' | translate }}"
                matInput
                [formControl]="searchPerson"
                [matAutocomplete]="personAutocomplete"
                />
              <mat-autocomplete
                #personAutocomplete="matAutocomplete"
                (optionSelected)="selectPerson($event)"
                [displayWith]="displayPersonName"
                >
                @for (person of filteredPersons$ | async; track person) {
                  <mat-option [value]="person._id">
                    {{ person.fullName }}
                  </mat-option>
                }
              </mat-autocomplete>
            </mat-form-field>
            @for (person of entity.persons; track person; let index = $index) {
              <div
                class="card"
                [class.invalid]="!Person.checkIsValid(person, entityId)"
                >
                <app-person [person]="person" [entityId]="entityId"></app-person>
                <div class="actions">
                  <button mat-icon-button color="warn" (click)="removeProperty(entity, 'persons', index)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            }
          </div>
        }
        </mat-tab> -->
        <!-- /Persons -->

        <!-- Institutions -->
        <!-- <mat-tab>
        @if (_id$ | async; as entityId) {
          <div>
            <mat-form-field>
              <mat-label>{{ 'Search for an existing institution' | translate }}</mat-label>
              <input
                type="text"
                placeholder="{{ 'Enter the name of an institution' | translate }}"
                matInput
                [formControl]="searchInstitution"
                [matAutocomplete]="instAutocomplete"
                />
              <mat-autocomplete
                #instAutocomplete="matAutocomplete"
                (optionSelected)="selectInstitution($event, entityId)"
                [displayWith]="displayInstitutionName"
                >
                @for (institution of filteredInstitutions$ | async; track institution) {
                  <mat-option
                    [value]="institution._id"
                    >
                    {{ institution.name }}
                  </mat-option>
                }
              </mat-autocomplete>
            </mat-form-field>
            @for (institution of entity.institutions; track institution; let index = $index) {
              <div
                class="card"
                [class.invalid]="!Institution.checkIsValid(institution, entityId)"
                >
                <app-institution [institution]="institution" [entityId]="entityId"></app-institution>
                <div class="actions">
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="removeProperty(entity, 'institutions', index)"
                    >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            }
          </div>
        }
        </mat-tab> -->
        <!-- /Institutions -->

        <!-- Related persons and institutions -->
        <mat-tab>
          @if (_id$ | async; as entityId) {
            <div>
              <mat-form-field>
                <mat-label>{{ 'Search for existing persons or institutions or add new ones:' | translate }}</mat-label>
                <input
                  type="text"
                  matInput
                  [formControl]="searchAgent"
                  [matAutocomplete]="agentAutocomplete"
                  />
                <mat-autocomplete
                  #agentAutocomplete="matAutocomplete"
                  (optionSelected)="selectAgent($event)"
                  [displayWith]="displayAgent"
                  >
                  <ng-container *ngIf="(filteredAgentList$ | async) as filteredAgentList">
                    <ng-container *ngIf="filteredAgentList.length > 0">
                      @for (agent of filteredAgentList; track agent) {
                        <mat-option
                        [value]="agent._id + ',' + (isPerson(agent) ? 'person' : 'institution')"
                        >
                        <ng-container *ngIf="isPerson(agent); else institutionBlock">
                          {{agent.fullName}}
                        </ng-container>
                        <ng-template #institutionBlock>
                          {{agent.name}}
                        </ng-template>
                      </mat-option>
                      }
                    </ng-container>
                  </ng-container>
                </mat-autocomplete>
              </mat-form-field>
              <app-agents [agent]="selectedAgent" [entityId]="entityId" [entity]="entity"></app-agents>

              <p [ngClass]="(hasRightsOwner$ | async) ? 'black-text' : 'accent-text'">Rightsowner:*</p>
              @for (agent of rightsOwnerList$ | async; track $index) {
                <app-agent-card [agent]="agent" [entityId]="entityId" (remove)="removeAgentRole(entity, (isPerson(agent) ? 'persons' : 'institutions'), 'RIGHTS_OWNER', entityId, agent._id.toString())"></app-agent-card>
              }

              <p [ngClass]="(hasCreator$ | async) ? 'black-text' : 'accent-text'">Creator:*</p>
              @for (agent of creatorList$| async; track agent; let index = $index) {
                <app-agent-card [agent]="agent" [entityId]="entityId" (remove)="removeAgentRole(entity, (isPerson(agent) ? 'persons' : 'institutions'), 'CREATOR', entityId, agent._id.toString())"></app-agent-card>
              }

              @if (contactPersonList$ | async; as contactPersonList) {
                @if(contactPersonList.length > 0) {
                  <p>Contact Person:</p>
                  @for (agent of contactPersonList; track $index) {
                    <app-agent-card [agent]="agent" [entityId]="entityId" (remove)="removeAgentRole(entity, (isPerson(agent) ? 'persons' : 'institutions'), 'CONTACT_PERSON', entityId, agent._id.toString())"></app-agent-card>
                  }
                }
              }

              @if (editorList$ | async; as editorList) {
                @if(editorList.length > 0) {
                  <p>Editor:</p>
                  @for (agent of editorList; track $index) {
                    <app-agent-card [agent]="agent" [entityId]="entityId" (remove)="removeAgentRole(entity, (isPerson(agent) ? 'persons' : 'institutions'), 'EDITOR', entityId, agent._id.toString())"></app-agent-card>
                  }
                }
              }

              @if (dataCreatorList$ | async; as dataCreatorList) {
                @if(dataCreatorList.length > 0) {
                  <p>Data Creator:</p>
                  @for (agent of dataCreatorList; track $index) {
                    <app-agent-card [agent]="agent" [entityId]="entityId" (remove)="removeAgentRole(entity, (isPerson(agent) ? 'persons' : 'institutions'), 'DATA_CREATOR', entityId, agent._id.toString())"></app-agent-card>
                  }
                }
              }
              <mat-divider></mat-divider>
              <div class="meta-button">
                <button
                  mat-flat-button
                  color="primary"
                  (click)="showSaveMessage()"
                  >
                  Save
                </button>
              </div>     
            </div>
          }


        </mat-tab>
          <!-- /Related persons and institutions-->

        <!-- Dimensions -->
        <!-- <mat-tab>
        @if (digitalEntity$ | async; as digitalEntity) {
        <div>
          @for (dimension of digitalEntity.dimensions; track dimension; let index = $index) {
            <div
              class="card"
              [class.invalid]="!DimensionTuple.checkIsValid(dimension)"
              >
              <mat-form-field>
                <mat-label>{{ 'Name' | translate }}</mat-label>
                <input
                  matInput
                  type="text"
                  name="name"
                  placeholder="{{ 'Enter a name' | translate }}"
                  [(ngModel)]="dimension.name"
                  />
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'Value' | translate }}</mat-label>
              <input
                matInput
                type="text"
                name="value"
                placeholder="{{ 'Enter a value' | translate }}"
                [(ngModel)]="dimension.value"
                />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{ 'Type' | translate }}</mat-label>
            <input
              matInput
              type="text"
              name="type"
              placeholder="{{ 'Enter a type' | translate }}"
              [(ngModel)]="dimension.type"
              />
        </mat-form-field>
        <div class="actions">
          <button
            mat-icon-button
            color="warn"
            (click)="removeProperty(digitalEntity, 'dimensions', index)"
            >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    }
        </div>
        }
        </mat-tab> -->
        <!-- /Dimensions -->

        <!-- Creation -->
        <mat-tab>
        @if (digitalEntity$ | async; as digitalEntity) {
          <app-creation [entity]="digitalEntity"></app-creation>
          <mat-divider></mat-divider>
          <app-creation-card [entity]="digitalEntity" (remove)="removeValueFromProperty(digitalEntity, $event)"></app-creation-card>
          <div class="meta-button">
            <button
              mat-flat-button
              color="primary"
              (click)="showSaveMessage()"
              >
              Save
            </button>
          </div>
        <!-- <div>
          <mat-form-field>
            <mat-label>{{ ' Add technique' | translate }}</mat-label>
            <input
              matInput
              type="text"
              name="technique"
              required
              />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{ 'Add software' | translate }}</mat-label>
            <input
              matInput
              type="text"
              name="program"
              required
              />
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{ 'Add equipment' | translate }}</mat-label>
            <input
              matInput
              type="text"
              name="equipment"
              />
        </mat-form-field>
        <mat-form-field>
          <mat-label>{{ 'Add creation date (format: yyyy-mm-dd)' | translate }}</mat-label>
          <input
            matInput
            type="text"
            name="date"
            />
        </mat-form-field>
        </div>
        <div class="meta-button">
          <button
            mat-flat-button
            color="primary"
            >
            Add
          </button>
        </div>
        <mat-divider></mat-divider>
        <div class="meta-button">
          <button
            mat-flat-button
            color="primary"
            (click)="showSaveMessage()"
            >
            Save
          </button>
        </div> -->
        <!-- Just for saving -->
        <!-- <div>
          @for (creation of digitalEntity.creation; track creation; let index = $index) {
            <div
              class="card"
              [class.invalid]="!CreationTuple.checkIsValid(creation)"
              >
              <mat-form-field>
                <mat-label>{{ 'Technique' | translate }}</mat-label>
                <input
                  matInput
                  type="text"
                  name="technique"
                  placeholder="{{ 'Enter a technique' | translate }}"
                  [(ngModel)]="creation.technique"
                  required
                  />
              </mat-form-field>
              <mat-form-field>
                <mat-label>{{ 'Program' | translate }}</mat-label>
                <input
                  matInput
                  type="text"
                  name="program"
                  placeholder="{{ 'Enter a program' | translate }}"
                  [(ngModel)]="creation.program"
                  required
                  />
              </mat-form-field>
              <mat-form-field>
                <mat-label>{{ 'Equipment' | translate }}</mat-label>
                <input
                  matInput
                  type="text"
                  name="equipment"
                  placeholder="{{ 'Enter an equipment' | translate }}"
                  [(ngModel)]="creation.equipment"
                  />
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'Date' | translate }}</mat-label>
              <input
                matInput
                type="text"
                name="date"
                placeholder="{{ 'Enter a date' | translate }}"
                [(ngModel)]="creation.date"
                />
          </mat-form-field>
          <div class="actions">
            <button
              mat-icon-button
              color="warn"
              (click)="removeProperty(digitalEntity, 'creation', index)"
              >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          </div>
          }
          </div> -->
        }
        </mat-tab>
        <!-- /Creation -->

        <!-- External Identifiers -->
        <!-- <mat-tab>
        <div>
          @for (externalId of entity.externalId; track externalId; let index = $index) {
            <div
              class="card"
              [class.invalid]="!TypeValueTuple.checkIsValid(externalId)"
              >
              <mat-form-field>
                <mat-label>{{ 'Type' | translate }}</mat-label>
                <input
                  matInput
                  type="text"
                  name="type"
                  placeholder="{{ 'Enter a type' | translate }}"
                  [(ngModel)]="externalId.type"
                  />
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'Value' | translate }}</mat-label>
              <input
                matInput
                type="text"
                name="value"
                placeholder="{{ 'Enter a value' | translate }}"
                [(ngModel)]="externalId.value"
                />
          </mat-form-field>
          <div class="actions">
            <button
              mat-icon-button
              color="warn"
              (click)="removeProperty(entity, 'externalId', index)"
              >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      }
        </div>
        </mat-tab> -->
        <!-- /External Identifiers -->

        <!-- External Links -->
        <mat-tab>
        <app-links [entity]="entity"></app-links>
        <mat-divider></mat-divider>
        @for (externalLink of entity.externalLink; track externalLink; let index = $index) {
          <div class="card">
              <ng-container>
                <p>{{ externalLink.description }}</p>
                <p>{{ externalLink.value }}</p>
              </ng-container>
              <div class="actions">
                <button
                  mat-icon-button
                  color="warn"
                  (click)="removeProperty(entity, 'externalLink', index)"
                  >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
          </div>
        }
        <!-- <div>
          @for (externalLink of entity.externalLink; track externalLink; let index = $index) {
            <div
              class="card"
              [class.invalid]="!DescriptionValueTuple.checkIsValid(externalLink)"
              >
              <mat-form-field>
                <mat-label>{{ 'Description' | translate }}</mat-label>
                <input
                  matInput
                  type="text"
                  name="description"
                  placeholder="{{ 'Enter a description' | translate }}"
                  [(ngModel)]="externalLink.description"
                  />
                </mat-form-field>
                <mat-form-field>
                  <mat-label>{{ 'Value' | translate }}</mat-label>
                  <input
                    matInput
                    type="text"
                    name="value"
                    placeholder="{{ 'Enter a value' | translate }}"
                    [(ngModel)]="externalLink.value"
                    />
                </mat-form-field>
                <div class="actions">
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="removeProperty(entity, 'externalLink', index)"
                    >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
          }            
        </div> -->
        </mat-tab>
        <!-- /External Links -->

        <!-- Bibliographic References -->
        <mat-tab>
          <div>
            <mat-form-field>
              <mat-label>{{ 'Value' | translate }}</mat-label>
              <input
                matInput
                type="text"
                name="value"
                placeholder="{{ 'Enter a value' | translate }}"
                [formControl]="biblioFormControl"
                />
            </mat-form-field>
          </div>
          <div class="meta-button">
            <button
              mat-flat-button
              color="primary"
              [disabled]="false"
              (click)="addBiblioRef(entity)"
              >
              Add
            </button>
          </div>
          <div>
            @for (biblioRef of entity.biblioRefs; track biblioRef; let index = $index) {
              <div class="card">
                <!-- <mat-form-field>
                  <mat-label>{{ 'Value' | translate }}</mat-label>
                  <input
                    matInput
                    type="text"
                    name="value"
                    placeholder="{{ 'Enter a value' | translate }}"
                    [(ngModel)]="biblioRef.value"
                    />
                </mat-form-field> -->
                <ng-container>
                  <p>{{biblioRef.value}}</p>
                </ng-container>
                <div class="actions">
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="removeProperty(entity, 'biblioRefs', index)"
                    >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            }
          </div>
        </mat-tab>
        <!-- /Bibliographic References -->

        <!-- Other -->
        <!-- <mat-tab>
          <div>
            @for (other of entity.other; track other; let index = $index) {
              <div
                class="card"
                [class.invalid]="!DescriptionValueTuple.checkIsValid(other)"
                >
                <mat-form-field>
                  <mat-label>{{ 'Description' | translate }}</mat-label>
                  <input
                    matInput
                    type="text"
                    name="description"
                    placeholder="{{ 'Enter a description' | translate }}"
                    [(ngModel)]="other.description"
                    />
                </mat-form-field>
                <mat-form-field>
                  <mat-label>{{ 'Value' | translate }}</mat-label>
                  <input
                    matInput
                    type="text"
                    name="value"
                    placeholder="{{ 'Enter a value' | translate }}"
                    [(ngModel)]="other.value"
                    />
                </mat-form-field>
                <div class="actions">
                  <button mat-icon-button color="warn" (click)="removeProperty(entity, 'other', index)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            }
          </div>
        </mat-tab> -->
        <!-- /Other -->

        <!-- Metadata Files -->
        <!-- <mat-tab>
          <div>
            <p>{{ 'Click the add button to browse for files you want to add.' | translate }}</p>
            <p>{{ 'These files will be available for download on the landing page of this entity.' | translate }}</p>
            <div class="file-list">
              @for (file of entity.metadata_files; track file; let index = $index) {
                <div class="card file">
                  <span>{{ file.file_name }}</span>
                  <span>{{ file.file_format }}</span>
                  <span>{{ file.file_size | filesize }}</span>
                  <div class="actions">
                    <button
                      mat-icon-button
                      color="warn"
                      (click)="removeProperty(entity, 'metadata_files', index)"
                      >
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </div>
              }
            </div>
          </div>
        </mat-tab> -->
        <!-- /Metadata Files -->

        <!-- Physical Objects -->
         <mat-tab>
          @if (digitalEntity$ | async; as digitalEntity) {
            <!-- <app-phys-obj [entity]="entity"></app-phys-obj> -->
            <app-phys-obj [entity]="digitalEntity"></app-phys-obj>
            <!-- @for (phyObj of digitalEntity.phyObjs; track phyObj; let index = $index) {
              <app-phys-obj [entity]="phyObj"></app-phys-obj>
            } -->
          <!-- <div>
            @for (phyObj of digitalEntity.phyObjs; track phyObj; let index = $index) {
              <div
                class="card"
                [class.invalid]="!PhysicalEntity.checkIsValid(phyObj)"
                >
                <app-entity [physicalEntity]="phyObj"></app-entity>
                <div class="actions">
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="removeProperty(digitalEntity, 'phyObjs', index)"
                    >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            }
          </div> -->
          }
         </mat-tab>

        <!-- /Physical Objects -->

      </mat-tab-group>
    </mat-sidenav-content>
  </mat-sidenav-container>
}
